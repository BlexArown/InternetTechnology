1. Почему в микросервисах нельзя просто использовать BEGIN TRANSACTION … COMMIT?  

Потому что в микросервисной архитектуре данные находятся в разных сервисах и разных базах данных, а обычная транзакция работает только внутри одной базы.  

В монолитном приложении:  
	BEGIN TRANSACTION;  
	UPDATE orders …;  
	UPDATE payments …;  
	COMMIT.  

Если ошибка - можно сделать ROLLBACK, и всё вернётся обратно.  

В микросервисах:  
	сервис заказов имеет свою БД;  
	сервис оплаты имеет свою БД;  
	сервис склада имеет свою БД.  

Одна SQL-транзакция не может управлять сразу всеми этими базами, потому что:
	они находятся на разных серверах;  
	они не знают друг о друге;  
	нет общего менеджера транзакций.  

Поэтому используется saga, которая выполняет шаги и компенсирует ошибки вручную.  

2. Разница между Оркестрацией и Хореографией  

Оркестрация это центральный сервис, оркестратор, который управляет всеми шагами.  

Пример:  
	saga service:  
		→ вызвать inventory service;  
		→ вызвать payment service;  
		→ вызвать delivery service.  

Особенности:  
	централизованное управление;  
	проще понимать и отлаживать;  
	проще реализовать.  

Хореография это когда нет центрального управляющего сервиса, а сервисы реагируют на события.  

Пример:  
	order service → событие OrderCreated;  
	inventory service → резервирует товар → событие reserved;  
	payment service → списывает деньги → событие paid.  

Особенности:  
	нет центра управления;  
	сервисы работают независимо;  
	сложнее отлаживать.  

Проще - оркестрация, так как логика в одном месте, легче понимать и легче писать.  

Лучше масштабируется - хореография, так как нет единой точки отказа, сервисы полностью независимы, легче добавлять новые сервисы.  

3. Что такое компенсирующая транзакция?  

Компенсирующая транзакция - это операция, которая отменяет результат предыдущего шага saga.  
Она используется, когда один из шагов saga завершился ошибкой.  

Пример:  
	saga:  
		Зарезервировать товар - OK;  
		Списать деньги - FAIL.  

Компенсация: Отменить резерв товара.    
Это возвращает систему в согласованное состояние.  

4. Может ли компенсирующая транзакция завершиться ошибкой?  

Да, может.  

Например: сервис склада временно недоступен, сеть не работает или база данных перегружена.  

Что делать в таком случае?  

Нужно использовать retry (повторные попытки), пока операция не выполнится успешно.  

Обычно применяют: повтор через несколько секунд, экспоненциальную задержку (1s → 2s → 4s → 8s), очередь сообщений.  

5. Что такое Eventual Consistency (согласованность в конечном счете)?  

Eventual Consistency означает, что данные могут быть временно несогласованы, но со временем станут согласованными.  
В микросервисах обновления происходят не мгновенно во всех сервисах.  

Пример:  
	Заказ создан → order service обновился;  
	payment service обновится через секунду;  
	inventory service обновится через 2 секунды.  

В течение короткого времени данные могут отличаться.  
Но через некоторое время все сервисы будут иметь одинаковые, согласованные данные.  
